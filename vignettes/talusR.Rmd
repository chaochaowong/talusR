---
title: "Introduction to talusR"
author:
  - name: "Chao-Jen Wong"
    affiliation: "Seattle Children's Research Institute"
    email: chao-jen.wong@seattlechildrens.org
date: "`r Sys.Date()`"
output:
  BiocStyle::html_document:
    toc_float: true
    number_sections: true
vignette: >
  %\VignetteIndexEntry{Introduction to talusR}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
library(knitr)
opts_chunk$set(
  eval = TRUE, 
  echo = TRUE, 
  warning = FALSE, 
  message = FALSE,
  fig.align = 'center',
  collapse = TRUE,
  comment = "#>",
  fig.width = 6,
  fig.height = 4
)
```

# Getting started

For now, this package only takes Talus data that are pre-processed by DIANN—i.e. that executed the normalization process and summarized the intensity signal in protein-level file (`*.tsv` or `*.csv`). The input metadata table (`*.csv`) must include a column (`which_run`) whose entries exactly match the sample (run) names in that abundance file.

This package also assumes that Talus processes only one sample in a single run (one mass-spectrometer acquisition) and with DIA-NN executed the normalization process across all the runs. 

Install `talusR`:
```{r install-talusR, eval=FALSE}
devtools::install_github('chaochaowong/talusR',
                         ref          = "dev",
                         dependencies = TRUE
)

# or to install the Bioconductor dependencies
BiocManager::install(
  "chaochaowong/talusR@dev",
  dependencies = TRUE
)
```

```{r load-library}
library(talusR)
```

# Import Talus data
Import test files by `read_talus()`.

## `split_by_fraction = FALSE`
When `split_by_fraction = FALSE`, `read_talus()` returns a single `TalusDataSet`.  This mode is ideal when:

- Your data have no fraction annotations       
- You want to run PCA-based QC to verify that protein-level signals from each fraction cluster as expected        

```{r import-test-data}
# get paths
protein_file <- system.file('extdata', 'test_data.tsv', 
                            package = 'talusR')
meta_file    <- system.file('extdata', 'test_meta.csv',
                            package = 'talusR')

# without split by fraction -> return TalusDataSet
tds  <- talusR::read_talus(file = protein_file,
                           meta_file = meta_file,
                           which_proteinid = "Protein.Ids",
                           which_run = "Run",
                           remove_few_measurements = TRUE,
                           split_by_fraction = FALSE)
tds
```

```{r pca-tds, fig.cap='PCA on TalusDataSet.'}
talusR::plot_pca(tds, color_by='Frx')
```

## `split_by_fraction = TRUE`
When `split_by_fraction = TRUE`, `read_talus()` returns a `TalusDataSetList` — a `SimpleList` of `TalusDataSet` objects, one per fraction, each holding its protein-level signals.

```{r split-by-fraction}
tdsl <- talusR::read_talus(file = file,
                           meta_file = meta_file,
                           which_proteinid = "Protein.Ids",
                           which_fraction = "Frx",
                           which_sequence = NA,
                           which_run = "Run",
                           remove_few_measurements = TRUE,
                           split_by_fraction = TRUE,
                           log_transform = 'log2',
                           intensity_group = "protein",
                           metric = "DIA-NN")
tdsl
```

```{r pca-tds-list, eval=FALSE}
talusR::plot_pca(tdsl, color_by='Frx')
```





